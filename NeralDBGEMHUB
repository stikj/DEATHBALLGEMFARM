local Library = loadstring(game:HttpGet('https://raw.githubusercontent.com/Loco-CTO/UI-Library/main/VisionLibV2/source.lua'))()
local Window = Library:Create({
    Name = "Deathball Farm V2",
    Footer = "By Neral (St1kJ)",
    Text = "Yawa",
    ToggleKey = Enum.KeyCode.Equals,
    LoadedCallback = function() end,
    KeySystem = false,
    Key = "INAMORAY123",
    MaxAttempts = 5,
    DiscordLink = "https://discord.gg/MA6CBKG64D",
    ToggledRelativeYOffset = 5
})

local Tab = Window:Tab({
    Name = "DEATHBALL MAIN FARM",
    Icon = "rbxassetid://111124850721058",
    Color = Color3.fromRGB(255, 255, 0),
    ActivationCallback = function() end,
    DeactivationCallback = function() end,
})

-- Main Section
local Section1 = Tab:Section({ Name = "Main" })

-- Anti-AFK Button
Section1:Button({
    Name = "Anti KFC(AFK)",
    Callback = function()
        local VirtualUser = game:GetService('VirtualUser')
        game:GetService('Players').LocalPlayer.Idled:Connect(function()
            VirtualUser:CaptureController()
            VirtualUser:ClickButton2(Vector2.new())
        end)
        Library:Notify({
            Name = "Anti AFK",
            Text = "Activated",
            Icon = "rbxassetid://136738330571760",
            Sound = "rbxassetid://6647898215",
            Duration = 5,
        })
    end
})

-- Auto Ready Toggle
local isAutoReadyActive = false
Section1:Toggle({
    Name = "Auto Ready",
    Default = false,
    Callback = function(state)
        isAutoReadyActive = state
        Library:Notify({
            Name = "Auto Ready",
            Text = state and "Enabled" or "Disabled",
            Icon = "rbxassetid://11401835376",
            Sound = "rbxassetid://6647898215",
            Duration = 5,
        })
    end,
})

-- Anti-Lag Toggle
Section1:Toggle({
    Name = "Anti-Lag",
    Default = false,
    Callback = function(state)
        if state then
            local Lighting = game:GetService("Lighting")
            local Terrain = workspace:FindFirstChildOfClass("Terrain")
            
            if Terrain then
                Terrain.WaterWaveSize = 0
                Terrain.WaterWaveSpeed = 0
                Terrain.WaterReflectance = 0
                Terrain.WaterTransparency = 0
            end
            
            Lighting.GlobalShadows = false
            Lighting.FogEnd = 9e9
            
            for _, v in ipairs(Lighting:GetDescendants()) do
                if v:IsA("PostEffect") then
                    v.Enabled = false
                end
            end
            
            for _, v in ipairs(workspace:GetDescendants()) do
                if v:IsA("BasePart") then
                    v.Material = Enum.Material.Plastic
                    v.Reflectance = 0
                elseif v:IsA("Decal") or v:IsA("Texture") then
                    v.Transparency = 1
                elseif v:IsA("ParticleEmitter") or v:IsA("Trail") then
                    v:Destroy()
                end
            end
            
            Library:Notify({
                Name = "Anti-Lag",
                Text = "Activated - FPS Booster enabled",
                Icon = "rbxassetid://11401835376",
                Sound = "rbxassetid://6647898215",
                Duration = 5,
            })
        else
            Library:Notify({
                Name = "Anti-Lag",
                Text = "Deactivated",
                Icon = "rbxassetid://11401835376",
                Sound = "rbxassetid://6647898215",
                Duration = 5,
            })
        end
    end,
})

-- Auto Disconnect Section
local Section2 = Tab:Section({ Name = "Auto Disconnect" })

local targetPlayerName = ""
local isAutoDisconnectActive = false

Section2:BigTextbox({
    Name = "Target Player",
    PlaceHolderText = "Enter Farmer Name",
    ResetOnFocus = true,
    Default = "",
    Callback = function(text)
        targetPlayerName = text
        Library:Notify({
            Name = "Target Player",
            Text = "Set to: " .. text,
            Icon = "rbxassetid://11401835376",
            Sound = "rbxassetid://6647898215",
            Duration = 3,
        })
    end,
})

Section2:Toggle({
    Name = "Auto Disconnect When Target Leaves",
    Default = false,
    Callback = function(state)
        isAutoDisconnectActive = state
        Library:Notify({
            Name = "Auto Disconnect",
            Text = state and "Enabled" or "Disabled",
            Icon = "rbxassetid://11401835376",
            Sound = "rbxassetid://6647898215",
            Duration = 5,
        })
    end,
})

-- Auto Disconnect if Players < 10
local autoDisconnectEnabled = false
Section2:Toggle({
    Name = "Auto Disconnect if Players < 10",
    Default = false,
    Callback = function(state)
        autoDisconnectEnabled = state
        Library:Notify({
            Name = "Auto Disconnect",
            Text = state and "Enabled" or "Disabled",
            Icon = "rbxassetid://11401835376",
            Sound = "rbxassetid://6647898215",
            Duration = 5,
        })
    end,
})

-- Player Count Check
local function checkPlayerCount()
    local Players = game:GetService("Players")
    if autoDisconnectEnabled and #Players:GetPlayers() < 10 then
        Library:Notify({
            Name = "Auto Disconnect",
            Text = "Server has fewer than 10 players. Disconnecting...",
            Icon = "rbxassetid://11401835376",
            Sound = "rbxassetid://6647898215",
            Duration = 5,
        })
        task.wait(3)
        game:GetService("Players").LocalPlayer:Kick("Server has fewer than 10 players.")
    end
end

game:GetService("Players").PlayerRemoving:Connect(function()
    task.wait(1)
    checkPlayerCount()
end)

-- Auto Collect Gems Section
local SectionGE = Tab:Section({ Name = "Auto Collect Gems" })

local AutoCollectEnabled = false

SectionGE:Toggle({
    Name = "Enable Auto Collect",
    Default = false,
    Callback = function(state)
        AutoCollectEnabled = state
        Library:Notify({
            Name = "Auto Collect",
            Text = state and "Enabled" or "Disabled",
            Icon = "rbxassetid://11401835376",
            Sound = "rbxassetid://6647898215",
            Duration = 2,
        })
    end,
})

-- Gem Collection Logic
local function collectGems()
    while AutoCollectEnabled do
        for _, parent in ipairs(workspace.FX:GetChildren()) do
            for _, gem in ipairs(parent:GetChildren()) do
                if gem.Name == "FakeGem" and gem:IsA("BasePart") then
                    game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = gem.CFrame
                    task.wait(0.1)
                end
            end
        end
        task.wait(1)
    end
end

workspace.FX.ChildAdded:Connect(function(child)
    task.wait(1)
    if AutoCollectEnabled then
        collectGems()
    end
end)
